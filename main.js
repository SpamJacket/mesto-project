/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var t,e,r=document.querySelector(".page"),n=r.querySelector(".content"),o=r.querySelector(".popup_type_avatar"),i=r.querySelector(".popup_type_profile"),a=r.querySelector(".popup_type_place"),u=r.querySelector(".popup_type_accept-delete"),c=r.querySelector(".popup_type_img"),l=document.forms.avatarForm,s=document.forms.profileForm,p=document.forms.placeForm,f=document.forms.acceptDeleteForm,d=l.querySelector(".popup__submit-button"),h=s.querySelector(".popup__submit-button"),y=p.querySelector(".popup__submit-button"),v=f.querySelector(".popup__submit-button"),m=l.elements.avatarLink,_=s.elements.profileName,g=s.elements.profileActivity,b=n.querySelector(".profile__name"),S=n.querySelector(".profile__activity"),w=p.elements.placeTitle,E=p.elements.placeLink,L=c.querySelector(".popup__image"),x=c.querySelector(".popup__caption"),q=document.querySelector("#gallery-item").content,k=n.querySelector(".gallery__list"),C=n.querySelector(".profile__avatar"),O=n.querySelector(".profile__edit-button"),j=n.querySelector(".profile__add-button"),P=(r.querySelector(".popup_type_avatar .popup__close-button"),r.querySelector(".popup_type_profile .popup__close-button"),r.querySelector(".popup_type_place .popup__close-button"),r.querySelector(".popup_type_accept-delete .popup__close-button"),r.querySelector(".popup_type_img .popup__close-button"),{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"}),T={baseUrl:"https://nomoreparties.co/v1/plus-cohort-22",headers:{authorization:"cb17d783-a9d0-4eeb-a054-218c1a23615d","Content-Type":"application/json"}};function A(t){t.classList.add("popup_opened"),document.addEventListener("keydown",I)}function N(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",I)}function I(t){"Escape"===t.key&&N(r.querySelector(".popup_opened"))}function F(t,e){t.textContent=e}function G(t){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G(t)}function U(){U=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof f?e:f,a=Object.create(i.prototype),u=new x(o||[]);return n(a,"_invoke",{value:S(t,r,u)}),a}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var p={};function f(){}function d(){}function h(){}var y={};c(y,i,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(q([])));m&&m!==e&&r.call(m,i)&&(y=m);var _=h.prototype=f.prototype=Object.create(y);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function o(n,i,a,u){var c=s(t[n],t,i);if("throw"!==c.type){var l=c.arg,p=l.value;return p&&"object"==G(p)&&r.call(p,"__await")?e.resolve(p.__await).then((function(t){o("next",t,a,u)}),(function(t){o("throw",t,a,u)})):e.resolve(p).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,u)}))}u(c.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function S(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var u=w(a,r);if(u){if(u===p)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=s(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function w(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var o=s(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,p;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function L(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function q(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:k}}function k(){return{value:void 0,done:!0}}return d.prototype=h,n(_,"constructor",{value:h,configurable:!0}),n(h,"constructor",{value:d,configurable:!0}),d.displayName=c(h,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,c(t,u,"GeneratorFunction")),t.prototype=Object.create(_),t},t.awrap=function(t){return{__await:t}},g(b.prototype),c(b.prototype,a,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new b(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(_),c(_,u,"Generator"),c(_,i,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=q,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(L),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),L(r),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:q(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},t}function B(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function D(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){B(i,n,o,a,u,"next",t)}function u(t){B(i,n,o,a,u,"throw",t)}a(void 0)}))}}function J(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status," ").concat(t.statusText))}function H(t){return M.apply(this,arguments)}function M(){return(M=D(U().mark((function t(e){return U().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",fetch(T.baseUrl+e,{method:"GET",headers:T.headers}).then(J));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function V(){return(V=D(U().mark((function t(e,r,n){return U().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",fetch(T.baseUrl+e,{method:"PATCH",headers:T.headers,body:JSON.stringify({name:r,about:n})}).then(J));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Y(){return(Y=D(U().mark((function t(e,r){return U().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",fetch(T.baseUrl+e,{method:"PATCH",headers:T.headers,body:JSON.stringify({avatar:r})}).then(J));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function z(){return(z=D(U().mark((function t(e,r,n){return U().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",fetch(T.baseUrl+e,{method:"POST",headers:T.headers,body:JSON.stringify({name:r,link:n})}).then(J));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function K(){return(K=D(U().mark((function t(e){return U().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",fetch(T.baseUrl+e,{method:"DELETE",headers:T.headers}).then(J));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Q(t,e){return R.apply(this,arguments)}function R(){return(R=D(U().mark((function t(e,r){return U().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",fetch(T.baseUrl+e,{method:r,headers:T.headers}).then(J));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function W(t){var e=q.querySelector(".gallery__item").cloneNode(!0),r=e.querySelector(".gallery__image");e.id=t._id,r.src=t.link,e.querySelector(".gallery__title").textContent=t.name,r.alt=t.name,r.addEventListener("click",(function(){A(c),L.src=t.link,x.textContent=t.name,L.alt=t.name}));var n,o=e.querySelector(".gallery__like"),i=e.querySelector(".gallery__like-counter");function a(t){!function(t){n=t.likes.map((function(t){return t._id}))}(t),i.textContent=n.length}a(t),n.includes(b.userId)&&o.classList.add("gallery__like_active"),o.addEventListener("click",(function(){n.includes(b.userId)?Q("/cards/likes/".concat(t._id),"DELETE").then((function(t){a(t),o.classList.remove("gallery__like_active")})).catch((function(t){return console.log(t)})):Q("/cards/likes/".concat(t._id),"PUT").then((function(t){a(t),o.classList.add("gallery__like_active")})).catch((function(t){return console.log(t)}))}));var l=e.querySelector(".gallery__delete-button");return t.owner._id!==b.userId&&l.remove(),l.addEventListener("click",(function(){A(u),f.cardId=t._id})),e}function X(t,e,r){var n=r.inputErrorClass,o=r.errorClass,i=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n),i.textContent="",i.classList.remove(o)}function Z(t,e,r){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(r),e.disabled=!1):(e.classList.add(r),e.disabled=!0)}function $(t,e){var r=e.inputSelector,n=e.submitButtonSelector,o=e.inactiveButtonClass,i=e.inputErrorClass,a=e.errorClass,u=Array.from(t.querySelectorAll(r));Z(u,t.querySelector(n),o),u.forEach((function(e){X(t,e,{inputErrorClass:i,errorClass:a})}))}t="/users/me",e="/cards",Promise.all([H(t),H(e)]).then((function(t){var e;e=t[0],b.textContent=e.name,b.userId=e._id,S.textContent=e.about,C.style="background-image: url('".concat(e.avatar,"');"),t[1].forEach((function(t){return function(t){k.append(W(t))}(t)}))})).catch((function(t){return console.log(t)})),C.addEventListener("click",(function(){l.reset(),$(l,P),A(o)})),l.addEventListener("submit",(function(t){t.preventDefault(),F(d,"Сохранение..."),function(t,e){return Y.apply(this,arguments)}("/users/me/avatar",m.value).then((function(){C.style='background-image: url("'.concat(m.value,'")'),N(o)})).catch((function(t){return console.log(t)})).finally((function(){return F(d,"Сохранить")}))})),O.addEventListener("click",(function(){_.value=b.textContent,g.value=S.textContent,$(s,P),A(i)})),s.addEventListener("submit",(function(t){t.preventDefault(),F(h,"Сохранение..."),function(t,e,r){return V.apply(this,arguments)}("/users/me",_.value,g.value).then((function(){b.textContent=_.value,S.textContent=g.value,N(i)})).catch((function(t){return console.log(t)})).finally((function(){return F(h,"Сохранить")}))})),j.addEventListener("click",(function(){p.reset(),$(p,P),A(a)})),p.addEventListener("submit",(function(t){t.preventDefault(),F(y,"Создание..."),function(t,e,r){return z.apply(this,arguments)}("/cards",w.value,E.value).then((function(t){var e;e=t,k.prepend(W(e)),N(a)})).catch((function(t){return console.log(t)})).finally((function(){return F(y,"Создать")}))})),f.addEventListener("submit",(function(t){t.preventDefault(),F(v,"Удаление..."),function(t){return K.apply(this,arguments)}("/cards/".concat(f.cardId)).then((function(){document.getElementById(f.cardId).remove(),N(u)})).catch((function(t){return console.log(t)})).finally((function(){return F(v,"Да")}))})),r.querySelectorAll(".popup").forEach((function(t){t.addEventListener("mousedown",(function(e){e.target.classList.contains("popup")&&N(t)}))})),r.querySelectorAll(".popup__close-button").forEach((function(t){var e=t.closest(".popup");t.addEventListener("click",(function(){N(e)}))})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var r=e.inputSelector,n=e.submitButtonSelector,o=e.inactiveButtonClass,i=e.inputErrorClass,a=e.errorClass,u=Array.from(t.querySelectorAll(r)),c=t.querySelector(n);Z(u,c,o),u.forEach((function(e){e.addEventListener("input",(function(){!function(t,e,r){e.validity.patternMismatch?e.setCustomValidity(e.dataset.textError):e.setCustomValidity(""),e.validity.valid?X(t,e,r):function(t,e,r,n){var o=n.inputErrorClass,i=n.errorClass,a=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o),a.textContent=r,a.classList.add(i)}(t,e,e.validationMessage,r)}(t,e,{inputErrorClass:i,errorClass:a}),Z(u,c,o)}))}))}(e,t)}))}(P)})();